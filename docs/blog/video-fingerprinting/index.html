<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="utf-8">
	<title>Video Fingerprinting</title>

	<!-- mobile responsive meta -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="description" content="In this post I want to share my experiments on how to generate video fingerprints.">
	
	<meta name="author" content="Jotschi">
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@metaloom" />
    <meta name="twitter:creator" content="" />
    <meta name="twitter:title" content="Video Fingerprinting" />
    <meta name="twitter:description" content="In this post I want to share my experiments on how to generate video fingerprints." />
    <meta name="twitter:image:src" content="https://metaloom.io/blog/video-fingerprinting/photo-1585079374502-415f8516dcc3.webp" />
    
    <meta property="og:title" content="Video Fingerprinting">
    <meta property="og:url" content="https://metaloom.io/blog/video-fingerprinting/">
    <meta property="og:description" content="In this post I want to share my experiments on how to generate video fingerprints.">
    <meta property="og:image" content="https://metaloom.io/blog/video-fingerprinting/photo-1585079374502-415f8516dcc3.webp">

	<meta name="generator" content="Hugo 0.80.0" />

	<!-- plugins -->
	
	<link rel="stylesheet" href="https://metaloom.io/plugins/fontawesome5/css/all.min.css">
	
	<link rel="stylesheet" href="https://metaloom.io/plugins/bootstrap/bootstrap.min.css">
	
	<link rel="stylesheet" href="https://metaloom.io/plugins/themify-icons/themify-icons.css">
	
	<link rel="stylesheet" href="https://metaloom.io/plugins/magnific-popup/magnific-popup.css">
	
	<link rel="stylesheet" href="https://metaloom.io/plugins/slick/slick.css">
	
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Anaheim%7cQuattrocento&#43;Sans:400,700&amp;display=swap">
	
	<link rel="stylesheet" href="https://metaloom.io/plugins/toc/bootstrap-toc.min.css">
	

	<!-- Main Stylesheet -->
	
	<link rel="stylesheet" href="https://metaloom.io/css/main.min.css" media="screen">

	<!--Favicon-->
	<link rel="shortcut icon" href="https://metaloom.io/images/favicon.png" type="image/x-icon">
	<link rel="icon" href="https://metaloom.io/images/favicon.png" type="image/x-icon">

	

</head>


<body id="body" data-spy="scroll" data-target=".navbar" data-offset="55">
  <div id="content">
    


<section class="sticky-top navigation">
	<div class="container">
		<nav class="navbar navbar-expand-lg navbar-dark">
			<a class="navbar-brand p-0" href="/">
				
				<img class="lozad" src="https://metaloom.io/images/logo_word_big.svg" alt="MetaLoom" height="42">
				
			</a>

			<button class="navbar-toggler rounded-0" type="button" data-toggle="collapse" data-target="#navigation">
				<span class="navbar-toggler-icon"></span>
			</button>

			<div class="collapse navbar-collapse" id="navigation">
				<ul class="navbar-nav ml-auto">
					
					<li class="nav-item">
            <a class="nav-link" href="/#feature">features</a>
					</li>
					
					<li class="nav-item">
            <a class="nav-link" href="/#team">developer</a>
					</li>
					
					<li class="nav-item">
            <a class="nav-link" href="/#blog">blog</a>
					</li>
					
				</ul>
				
			</div>
		</nav>
	</div>
</section>


<section class="section">
  <div class="container">
    <div class="row">
      <div class="col-lg-3 d-none d-lg-block toc-sticky-top">
        <nav id="toc"></nav>
      </div>
      <div class="col-lg-9 text-center">
        <h1>Video Fingerprinting</h1>
        <ul class="list-inline mb-50">
          <li class="list-inline-item"><a href="/author/jotschi/">jotschi</a></li>
          <li class="list-inline-item">Wednesday, May 19, 2021</li>
        </ul>
        <img class="img-fluid lozad" src="photo-1585079374502-415f8516dcc3.jpg" data-src="photo-1585079374502-415f8516dcc3.jpg" alt="blog-image">
        <div class="image-credit">
          Credit: Photo by George Prentzas on Unsplash
        </div>
      </div>
      <div class="col-lg-9 offset-lg-3">
        <div class="post-single-content">
          <div class="sect1">
<h2 id="_intro">Intro</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this post I want to share my experiments on how to generate video fingerprints.</p>
</div>
<div class="paragraph">
<p>The goal of the <a href="https://en.wikipedia.org/wiki/Digital_video_fingerprinting">fingerprinting</a> is to enable identification and comparing processes for video media.</p>
</div>
<div class="paragraph">
<p>Fingerprinting is the key process that is needed to handle comparing processes, similarity search, de-duplication and video identification.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_basics">Basics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Fingerprinting works by generating a binary hash of the image. These hashes can in turn be compared to each other. Lets take a look on how this process works with text first before we dive into media hashing.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;"/>
<col style="width: 50%;"/>
<col style="width: 33.3334%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Text</th>
<th class="tableblock halign-left valign-top">Bin</th>
<th class="tableblock halign-left valign-top">Diff</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">01101100011011110<code>1101111</code>01101101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lo0m</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">01101100011011110<code>0110000</code>01101101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In this example shows that both strings have a difference of 6 bits. The remaining bits are similar. The same process can be applied to video fingerprinting. By comparing a generated hash from one video to another it is possible to determine whether both videos share similar characteristics which were encoded in the fingerprint hash.</p>
</div>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Levenshtein_distance">Levenshtein distance</a> describes this metric in more detail.</p>
</div>
<div class="paragraph">
<p>For a large set of fingerprints it is however not feasible to pre-compute all Levenshtein distances for all fingerprint combinations.</p>
</div>
<div class="paragraph">
<p>Another approach to handle comparing fingerprints is to use <a href="https://en.wikipedia.org/wiki/Nearest_neighbor_search">Nearest neighbor search</a>. In this case the fingerprint can be seen as a multidimensional vector. Similar vectors are closer in relation and thus NNS can be applied to find neighbors similar to the selected fingerprint.</p>
</div>
<div class="paragraph">
<p>The last approach is to store the fingerprint as a vector in a binary tree. Queries can be run against this tree to determine nearest neighbors.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Additional information can of course also be included in the vectors to search for more specific traits of the media. Outside of media fingerprinting this process may also be used for product suggestions / recommendations. User, product, behaviour information may be added to the vectors which can be searched.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>There are various projects on github which also allow the creation and storage of such binary trees for <a href="https://github.com/erikbern/ann-benchmarks">nearest neighbor search</a>.</p>
</div>
<div class="paragraph">
<p>The one I tested was <a href="https://github.com/spotify/annoy">Annoy</a> from spotify.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_process">Process</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For video you of course need to deal with image data.
The process I came up with works as following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Seek to 15% position of the video</p>
</li>
<li>
<p>Iterate over a given amount of frames</p>
</li>
<li>
<p>Skip black frames (e.g. cut-screen frames)</p>
</li>
<li>
<p>Process the frame by reducing, greyscaling, bluring, normalizing it</p>
</li>
<li>
<p>Stack/Combine the frames additively into a single output image</p>
</li>
<li>
<p>Reduce the output image to a binary color precision</p>
</li>
<li>
<p>Convert the image into a bitstream</p>
</li>
<li>
<p>Convert to hex</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>I decided to try the stacking approach in order to get generate fingerprints which were less prone to slight changes in framerate and start offset.
In order to speedup the process some of the frames after a taken frame will be omitted.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_detailed_process">Detailed Process</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_stage_1_source">Stage 1 - Source</h3>
<div class="paragraph">
<p>Resize the source frame to 512x512.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="stage-1.jpg" alt="stage 1"/>
</div>
<div class="title">Figure 1. Source frame</div>
</div>
</div>
<div class="sect2">
<h3 id="_stage_2_preparation">Stage 2 - Preparation</h3>
<div class="paragraph">
<p>Convert to greyscale and normalize the image to reduce extra bright spots.
Blur the image and normalize again. Now stack the resulting frame with the previously processed frame.
Resize to 16x16 pixel</p>
</div>
<div class="imageblock">
<div class="content">
<img src="stage-2.jpg" alt="stage 2"/>
</div>
<div class="title">Figure 2. Reduced</div>
</div>
</div>
<div class="sect2">
<h3 id="_stage_3_normalize">Stage 3 - Normalize</h3>
<div class="paragraph">
<p>Normalize the image</p>
</div>
<div class="imageblock">
<div class="content">
<img src="stage-3.jpg" alt="stage 3"/>
</div>
<div class="title">Figure 3. Normalized</div>
</div>
</div>
<div class="sect2">
<h3 id="_stage_4_stacking">Stage 4 - Stacking</h3>
<div class="paragraph">
<p>Stack the frame with the previously frame</p>
</div>
<div class="imageblock">
<div class="content">
<img src="stage-4.jpg" alt="stage 4"/>
</div>
<div class="title">Figure 4. Stacked</div>
</div>
</div>
<div class="sect2">
<h3 id="_stage_5_normalize">Stage 5 - Normalize</h3>
<div class="paragraph">
<p>Normalize the stacked image to reduce bright spots that may have been created due to stacking.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="stage-5.jpg" alt="stage 5"/>
</div>
<div class="title">Figure 5. Normalized</div>
</div>
</div>
<div class="sect2">
<h3 id="_stage_6_binary">Stage 6 - Binary</h3>
<div class="paragraph">
<p>Convert grey values to one bit precision.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="stage-6.jpg" alt="stage 6"/>
</div>
<div class="title">Figure 6. Result</div>
</div>
<div class="paragraph">
<p>The result image content gets converted into hex which forms the final fingerprint value.</p>
</div>
<div class="paragraph">
<p><code>060007000f003e001d0085000600f40076597a007c86ffdefffffefffcfffdff01</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_example_video">Example Video</h3>
<div class="paragraph">
<p>This video shows the stacking process in action using a sample video from big buck bunny.</p>
</div>
<div class="videoblock">
<div class="content">
<video src="processing.mp4" width="100%" autoplay="" controls="" loop="">
Your browser does not support the video tag.
</video>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_other_sources">Other sources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_phash">pHash</h3>
<div class="paragraph">
<p><a href="https://www.phash.org/">pHash</a> is an open source perceptual hashing mechanism for media.
As far as I recall it uses edge detection to find specific areas of the video which are more prominent. The detected edges are transformed via <a href="https://en.wikipedia.org/wiki/Hough_transform">Hough Transform</a> into a different spatial data which is robust to scaling and rotation. A more detailed description can be found in this post: <a href="https://www.programmersought.com/article/58297818060/">Phash knows the perception of the human eye</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_chromaprint">Chromaprint</h3>
<div class="paragraph">
<p>Chromaprint is mainly designed for audio but shares some concepts to video fingerprinting.
The main aspect is that fourier transformation is applied to the audio data to prepare it for processing. Checkout the authors detailed explanation on how <a href="https://oxygene.sk/2011/01/how-does-chromaprint-work/">Chromaprint</a> works.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_final_thoughts">Final thoughts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>My initial implementation of this process works as expected but there still some cases in which the fingerprint process will not yield a meaningful stacked image / generated hash. I assume there may be a problem with the selection process of frames or that the normalization does not work as expected. I have to look into this.</p>
</div>
<div class="paragraph">
<p>I hope this post was interesting to you. I may create a follow-up post in the future which will cover the actual storage and query processes for the generated fingerprints.</p>
</div>
</div>
</div>

        </div>
        
        

<div class="social-share pt-4">
	<h4>Share:</h4>

	
	<a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=Video%20Fingerprinting&amp;url=https%3a%2f%2fmetaloom.io%2fblog%2fvideo-fingerprinting%2f"
		target="_blank" rel="noopener" aria-label="">
		<div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small">
			<div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
					<path
						d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5 0-4.55 2.04-4.55 4.54 0 .36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3 0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35 0 12.92-6.92 12.92-12.93 0-.2 0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z" />
				</svg>
			</div>
		</div>
	</a>

	
	<a class="resp-sharing-button__link" href="mailto:?subject=Video%20Fingerprinting&amp;body=https%3a%2f%2fmetaloom.io%2fblog%2fvideo-fingerprinting%2f" target="_self"
		rel="noopener" aria-label="">
		<div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small">
			<div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
					<path
						d="M22 4H2C.9 4 0 4.9 0 6v12c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17 0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1 0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08 0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z" />
				</svg>
			</div>
		</div>
	</a>

	
	<a class="resp-sharing-button__link"
		href="https://reddit.com/submit/?url=https%3a%2f%2fmetaloom.io%2fblog%2fvideo-fingerprinting%2f&amp;resubmit=true&amp;title=Video%20Fingerprinting" target="_blank"
		rel="noopener" aria-label="">
		<div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small">
			<div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
					<path
						d="M24 11.5c0-1.65-1.35-3-3-3-.96 0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65 0 3-1.35 3-3s-1.35-3-3-3c-1.38 0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65 0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66 0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64 0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4 0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6 0 .23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1 0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z" />
				</svg>
			</div>
		</div>
	</a>
</div>
        
        
        <div class="mt-5">
          
        </div>
      </div>
    </div>
  </div>
</section>

  </div><!-- end Contact Area -->
<footer id="footer" class="section-bg">
	<div class="container">
		<div class="row wow fadeInUp" data-wow-duration="500ms">
			<div class="col-xl-12">

				<!-- Footer Social Links -->
				<div class="social-icon">
					<ul class="list-inline">
						
						<li class="list-inline-item"><a href="#"><i class="ti-twitter-alt"></i></a></li>
						
					</ul>
				</div>

				<!-- copyright -->
				<div class="copyright text-center">
					<a href="https://metaloom.io/">
						<img src="https://metaloom.io/images/logo_word_big.svg" alt="MetaLoom" height="42" />
					</a>
					<br>
					<p></p>
				</div>
			</div>
		</div>
	</div>
</footer>
<!-- /footer -->

<!-- Google Map API -->


<!-- JS Plugins -->

<script src="https://metaloom.io/plugins/jquery/jquery.min.js"></script>

<script src="https://metaloom.io/plugins/bootstrap/bootstrap.min.js"></script>

<script src="https://metaloom.io/plugins/slick/slick.min.js"></script>

<script src="https://metaloom.io/plugins/shuffle/shuffle.min.js"></script>

<script src="https://metaloom.io/plugins/magnific-popup/jquery.magnific-popup.min.js"></script>

<script src="https://metaloom.io/plugins/lazy-load/lozad.min.js"></script>

<script src="https://metaloom.io/plugins/toc/bootstrap-toc.min.js"></script>

<script src="https://metaloom.io/plugins/toc/toc.js"></script>


<!-- Main Script -->

<script src="https://metaloom.io/js/script.min.ed4983fca60a27703dce4fccd609153c3b5b97900c0300c0a0271a173b645f3dd0befb42da19ab19abf27f9176707e7a.js" integrity="sha384-7UmD/KYKJ3A9zk/M1gkVPDtbl5AMAwDAoCcaFztkXz3QvvtC2hmrGavyf5F2cH56"></script>

<!-- Highlight Script -->
<link rel="stylesheet" href="/plugins/highlight/styles/obsidian.css">
<script src="/plugins/highlight/highlight.pack.js"></script>
<script>hljs.highlightAll();</script>


</body>

</html>
